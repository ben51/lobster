#!/usr/bin/env ruby

require 'lobster'
require 'daemons'

lobster_dir = File.expand_path(ENV['LOBSTER_DIR'] || '.')
log_dir = File.join(lobster_dir, 'log')

Dir.mkdir log_dir unless Dir.exist?(log_dir) || ARGV.first == "run"

#puts "LOBSTER_DIR set to #{lobster_dir}"

options = {
  :multiple => false,
  :monitor => true,
  :backtrace => true,
  :log_dir => File.join(lobster_dir, 'log'),
  :log_output => true
}
options[:dir_mode] = :system unless ARGV.first == "run"
options[:log_dir] = File.join(lobster_dir, 'log')

Daemons.run_proc('lobster', options) do
  Lobster::Service.start(lobster_dir)
end
